# 一括アンケート分析ツール 取扱説明書

## 1. 概要

このツールは、Excelファイルに含まれるアンケートの自由回答テキストを一括で分析し、その結果を様々な形式で出力するためのアプリケーションです。

主な機能:
- **Excel一括処理:** Excelファイルを読み込み、指定した列のテキストを一度に分析します。
- **高度な日本語分析:** `spaCy`と`SudachiPy`による日本語形態素解析と、OpenAIのLLM（`gpt-4o-mini`）を活用し、各回答の「感情」「主要トピック」「代表的な引用」「改善提案の有無」を抽出します。
- **多様なアウトプット:**
  1. **分析結果付きExcel:** 元のデータに分析結果の列を追加して保存します。
  2. **サマリーPDF:** 全体の傾向をまとめたグラフ付きのPDFレポートを生成します。
  3. **ワードクラウド:** 頻出単語を視覚化した画像を生成します。

## 2. セットアップ（初回のみ）

アプリケーションを使用する前に、以下の手順で環境をセットアップしてください。

### ステップ1: フォントの準備

PDFやグラフで日本語を正しく表示するため、事前に日本語フォントを準備します。
`fonts` フォルダには **TTF 形式** の `NotoSansJP-Regular.ttf` を配置してください。
**重要**: OTF 形式は `fpdf2` でサポートされずエラーになります。必ず TTF 版を用意してください。
Windows の既存フォント (Meiryo など) も利用できます。PDF生成には `fpdf2` を使用しており、`.ttc` 形式のフォントも利用可能です。
Noto Sans JP は [Google Fonts](https://fonts.google.com/noto/specimen/Noto+Sans+JP) から入手できます。

### ステップ2: APIキーの設定

このツールはOpenAIのAPIを使用します。APIキーを環境変数として設定してください。

- 変数名: `OPENAI_API_KEY`
- 値: `sk-`で始まるあなたのOpenAI APIキー

または、プロジェクトフォルダに `.env` という名前のファイルを作成し、`OPENAI_API_KEY="sk-..."` のように記述することも可能です。

### ステップ3: 必要なライブラリのインストール

ターミナル（コマンドプロンプト）を開き、このプロジェクトのディレクトリに移動して、以下のコマンドを実行します。

```bash
pip install -r requirements.txt
```

## 3. アプリケーションの起動方法

ターミナルで以下のコマンドを実行します。

```bash
python main.py
```

## 4. 使用方法

1. **Excelファイルの選択:**
   - 起動したウィンドウの左上にある「Excelファイルを選択」ボタンをクリックし、分析したいExcelファイルを選びます。

2. **分析対象列の選択:**
   - ファイルを読み込むと、Excelの列名がドロップダウンメニューに表示されます。分析したい自由回答が入力されている列を選択してください。

3. **分析実行:**
   - 「分析実行」ボタンをクリックします。処理が始まり、プログレスバーが進捗状況を示します。
   - データ量によっては時間がかかる場合があります。処理が完了すると、ポップアップで通知されます。

4. **結果の保存:**
   - 分析が完了すると、3つの保存ボタンが有効になります。
  - **「分析結果をExcelに保存」:** 元のデータに分析結果の列を追加し、`analysis_key_topics` は `analysis_key_topics_1` のようにトピックごとに分割した状態で新しいExcelファイルを保存します。
   - **「サマリーPDFを保存」:** 全体の感情分析（円グラフ）や主要トピック（棒グラフ）をまとめたPDFレポートを保存します。
   - **「ワードクラウドを保存」:** テキスト全体から頻出単語を抽出して作成したワードクラウド画像をPNGファイルとして保存します。

## 5. トラブルシューティング

- **APIエラーが表示される:**
  - `OPENAI_API_KEY`が正しく設定されているか確認してください。
  - OpenAIのAPI残高が不足していないか確認してください。

- **グラフやPDFの日本語が四角（豆腐）になる:**
  - Windowsの日本語フォントが利用できないか、`fonts`フォルダにフォントが配置されていない可能性があります。必要に応じて`NotoSansJP-Regular.otf`を配置してください。
- **PDF生成でFileNotFoundErrorが出る:**
  - `fonts/NotoSansJP-Regular.otf` が存在するか確認してください。

- **アプリケーションが起動しない:**
  - 「ステップ3: 必要なライブラリのインストール」が正しく完了しているか確認してください。再度 `pip install -r requirements.txt` を実行してみてください。
